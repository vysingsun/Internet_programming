<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>exe2</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div class="w-[90%] h-[75vh] border-4 border-black m-auto flex">
        <div class="w-[10%] text-center"><strong id="pagenum"></strong></div>
        <div  id="scrollable-wrapper" class="w-[90%] h-full  overflow-y-auto bg-[#d3d3d3] p-2">
            
        </div>
    </div>
    <script>
        let scrollerEle = document.getElementById("scrollable-wrapper");
        let page = 1;
        // let limit = 10;
        let loading = false;
        let outPut = '';
        let pageEle = document.getElementById('pagenum');

        const loadData = () => {
            if (localStorage.getItem('page0') == null && page == 0) {
                let data1 = [{}];
                let airline='';
                for (i = 0; i < localStorage.length; i++) {
                    data1[i] = JSON.parse(localStorage.getItem(`page${i}`));
                        // console.log(data1[i]);
                        
                    for (j in data1[i]) {
                        outPut+=`
                            <div class="bg-white w-full pb-[5%] my-1">
                                <div class="flex">
                                    <div>âœˆ: </div>
                                    <div> ${data1[i][j].airline[0].name} - ${data1[i][j].airline[0].country}</div>
                                </div>
                                <div class="flex">
                                    <div>ðŸ™‚: ${data1[i][j].name}</div>
                                    <div>Pedro</div>
                                </div>
                            </div>
                            `
                    }
                        
                }
                scrollerEle.innerHTML = outPut;
                
                page = i;
            }else if(page>=0){
                fetch(`https://api.instantwebtools.net/v1/passenger?page=${page}&size=${10}`).then(async(arrData) => {
                    let results = await arrData.json();
                    let airline = '';
                    let data = [{}];
                    for (let result = 0; result < 10; result++) {
                        airline = results.data[result].airline;
                        // console.log(airline);
                        const dataAdd = {
                            name: `${results.data[result].name}`,
                            airline: [{
                                name: `${airline[0].name}`,
                                country: `${airline[0].country}`
                            }]
                        };
                        data[result] = dataAdd;
                        outPut += `
                        <div class="bg-white w-full pb-[5%] my-1">
                            <div class="flex">
                                <div>âœˆ: </div>
                                <div> ${airline[0].name} - ${airline[0].country}</div>
                            </div>
                            <div class="flex">
                                <div>ðŸ™‚: ${results.data[result].name}</div>
                                <div>Pedro</div>
                            </div>
                        </div>
                        `
                    }
                    localStorage.setItem(`page${page}`, JSON.stringify(data));
                    scrollerEle.innerHTML = outPut;
                    page++;
                    pageEle.textContent = page;
                });
            }      
        }
        loadData();
        pageEle.textContent = page;
 
        scrollerEle.addEventListener("scroll", (event) => {
          if (scrollerEle.scrollTop + scrollerEle.clientHeight >= (scrollerEle.scrollHeight * 0.97)) {
            /// to fetch next page from api
            
                localStorage.length = '';
                loadData();   
          }
        })
    </script>
</body>
</html>