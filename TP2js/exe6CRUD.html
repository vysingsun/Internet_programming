<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>exe6</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
</head>
<body class="flex justify-center w-[100%] h-[100vh]">
    <div class="w-full h-full flex">
        <div  class="bg-[#ebebeb] w-[30%] h-full p-2">
            <form autocomplete="on" onsubmit="onFormSubmit()">
                <div class="header-add">Add new book</div>
                <div for="name">Name: </div>
                <input type="text" name="name" id="name_book" placeholder="c programming" onclick="if(this.placeholder == 'c programming') {this.placeholder = ''}" onBlur="if(this.placeholder == '') {this.placeholder = 'c programming'}" />
                <div for="category">Category: </div>
                <input type="text" name="category" id="category_book" placeholder="coding" onclick="if(this.placeholder == 'coding') {this.placeholder = ''}" onBlur="if(this.placeholder == '') {this.placeholder = 'coding'}" />
                <div for="price">Price: </div>
                <input type="text" name="price" id="price_book" placeholder="1,000 riels" onclick="if(this.placeholder == '1,000 riels') {this.placeholder = ''}" onBlur="if(this.placeholder == '') {this.placeholder = '1,000 riels'}" />
                <div class="flex gap-2 py-2">
                    <button type="submit" class="bg-white rounded-sm">Add</button>
                    <button type="submit" class="bg-white rounded-sm">Update</button>
                </div>    
            </form>
        </div>
        <div class="w-[70%] h-full bg-[#ebebeb] ml-2 p-2">
            <div class="w-full h-[60%] grid grid-cols-3 gap-[2%] overflow-y-auto" id="add_items"></div>
        </div>
    </div>
    <script>
        var selectedRow = null;
        let x = -1;
        var names = [];
        var price = [];
        var category = [];
        let header = document.getElementsByClassName("header-add")[0];

        function onFormSubmit(e) {
            event.preventDefault();
            var formData = readFormData();
            if (selectedRow === null) {
                insertNewRecord(formData);
                console.log("welcome to book shop!")
            } else {
                updateRecord(formData);
            }
            resetForm();
        }

        //clear placeholder in box
        document.querySelector('.add_book').placeholder = '';

        //Retrieve the data
        function readFormData() {
            var formData = {};
            formData["name_book"] = document.getElementById("name_book").value;
            formData["category_book"] = document.getElementById("category_book").value;
            formData["price_book"] = document.getElementById("price_book").value;
            
            return formData;
        }

        //Insert the data
        function insertNewRecord(data) {
            names[x + 1] = data.name_book;
            price[x + 1] = data.price_book;
            category[x + 1] = data.category_book;

            document.getElementById("add_items").innerHTML += `<div class="bg-white w-full h-[100%] rounded-lg p-1">
                
                    <div class="flex justify-end gap-[2%]">
                        <div>
                            <button id="${parseInt(x+1)}" class=" bg-[#ebebeb] rounded-sm" onclick="deleteBook(this.id)">Delete</button>
                        </div>
                        <div>
                            <button id="${parseInt(x+1)}" class="bg-[#ebebeb] rounded-sm" onclick="editBook(this.id)">Change name</button>
                        </div>
                    </div>
                    <img src="book.png" alt="#book_picture">
                    <div class="name" data="${data.name_book}">Name : ${data.name_book}</div>
                    <div class="category">Category : ${data.category_book}</div>
                    <div class="price">Price : ${data.price_book} riels</div>  
                      
            </div>`;
            x++;
        }

        //update data
        function editBook(id) {
            header.innerHTML = "Update information book!";
            header.style.backgroundColor = "rgba(110, 237, 156, 15)";

            selectedRow = id;
            document.getElementsByClassName("edit_book")[0].style.visibility = 'visible';
            document.getElementsByClassName("add_book")[0].style.visibility = 'hidden';

            document.getElementById('name_book').value = names[id];
            document.getElementById('category_book').value = category[id];
            document.getElementById('price_book').value = price[id];
            
        }

        function updateRecord(formData) {
            document.getElementsByClassName("name")[selectedRow].innerHTML = "Name : " + formData.name_book;
            document.getElementsByClassName("price")[selectedRow].innerHTML = "Price : " + formData.price_book + " riels";
            document.getElementsByClassName("category")[selectedRow].innerHTML = "Category : " + formData.category_book;
            document.getElementsByClassName("edit_book")[0].style.visibility = 'hidden';
            document.getElementsByClassName("add_book")[0].style.visibility = 'visible';

            document.getElementsByClassName("header-add")[0].innerHTML = "Add New Book";
            header.style.backgroundColor = "rgb(158, 196, 125)";
            selectedRow = null;
        }

        //delete data
        function deleteBook(id) {
            console.log(id);
            if (confirm('Are you sure want to delete this book?')) {
                document.getElementsByClassName('items')[id].hidden = true;
            }
            resetForm();
        }

        function resetForm() {
            document.getElementById('name_book').value = '';
            document.getElementById('category_book').value = '';
            document.getElementById('price_book').value = '';
            
        }
    </script>
</body>
</html>